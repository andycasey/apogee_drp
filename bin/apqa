#!/usr/bin/env python
# encoding: utf-8
#
# @Author: David Nidever, Drew Chojnowski
# @Date: Nov 2020
# @Filename: apqa
# @License: BSD 3-Clause
# @Copyright: David Nidever, Drew Chojnowski

# Run QA for a single night

from __future__ import division
from __future__ import print_function
from __future__ import absolute_import
from __future__ import unicode_literals

import argparse
import os
import sys
import time
import datetime
import glob
import numpy as np
from astropy.table import Table,Column
import logging

from apogee_drp.apred import qa
from dlnpyutils import utils as dln

if __name__ == '__main__' :

    parser = argparse.ArgumentParser(
        prog=os.path.basename(sys.argv[0]),
        description='Run QA')

    parser.add_argument('mjd', type=str, nargs=1,  help='Night MJD5')
    parser.add_argument('observatory', type=str, nargs=1, help='APOGEE observatory (apo or lco)')
    parser.add_argument('--apred', type=str, nargs=1, default='daily', help='APOGEE reduction version')
    args = parser.parse_args()

    logger = dln.basiclogger()
    logger.handlers[0].setFormatter(logging.Formatter("%(asctime)s [%(levelname)-5.5s]  %(message)s"))
    logger.handlers[0].setStream(sys.stdout)   

    now = datetime.datetime.now()
    start = time.time()
    logger.info("Start: "+now.strftime("%Y-%m-%d %H:%M:%S"))

    # Code copied from rv.dopple_rv()
    mjd = args.mjd[0]
    observatory = args.observatory[0]
    apred = args.apred

    # Run the QA code
    qa.apqaMJD(mjd=mjd, observatory=observatory, apred=apred)

    now = datetime.datetime.now()
    logger.info("End: "+now.strftime("%Y-%m-%d %H:%M:%S"))
    logger.info("elapsed: %0.1f sec." % (time.time()-start))
